Components.utils.import("resource://gre/modules/XPCOMUtils.jsm");const CI=Components.interfaces,CC=Components.classes,CR=Components.results;var componentobj=null;var blockTypes=[];blockTypes[CI.nsIContentPolicy.TYPE_SCRIPT]=true;blockTypes[CI.nsIContentPolicy.TYPE_IMAGE]=true;blockTypes[CI.nsIContentPolicy.TYPE_SUBDOCUMENT]=true;blockTypes[CI.nsIContentPolicy.TYPE_OBJECT]=true;var Accept=CI.nsIContentPolicy.ACCEPT;var RejectType=CI.nsIContentPolicy.REJECT_TYPE;var RejectRequest=CI.nsIContentPolicy.REJECT_REQUEST;function MozPolicyComponent(){}function GetOwnerWindow(html_node){return html_node.ownerDocument.defaultView}MozPolicyComponent.prototype={classDescription:"MozContentPolicyHandler",classID:Components.ID("{6C157BE4-6B9D-4C9B-AE0F-35ABB508DDDE}"),contractID:"@se7en-soft.com/mozpolicycomp;1",QueryInterface:XPCOMUtils.generateQI([CI.nsIContentPolicy,CI.nsISupports,CI.nsISupportsWeakReference]),_xpcom_categories:[{category:"content-policy"}],_xpcom_factory:{createInstance:function(outer,iid){if(outer){throw CR.NS_ERROR_NO_AGGREGATION}if(componentobj==null){componentobj=new MozPolicyComponent()}else{}return componentobj.QueryInterface(iid)}},shouldLoad:function(contentType,contentLocation,requestOrigin,aContext,mimeTypeGuess,extra){let result=Accept;if(!blockTypes[contentType]||(contentLocation.scheme!='http'&&contentLocation.scheme!='https'))return result;var _isWindow=false;var element=aContext.QueryInterface(CI.nsIDOMElement);if(element==null)_isWIndow=true;var _pwnd;if(_isWindow)_pwnd=element;else _pwnd=GetOwnerWindow(element);var _location=contentLocation!=null?contentLocation.spec:"";var _origin=requestOrigin!=null?requestOrigin.spec:"";var managed_result=Accept;managed_result=_pwnd.external.shouldLoad(_pwnd,contentType.toString(),_location,_origin,element);if(managed_result!=1){try{aContext=aContext.QueryInterface(CI.nsIDOMElement);var head=aContext.parentNode.getElementsByTagName('head')[0];head.appendChild(aContext);aContext.style.display='none';head.removeChild(aContext)}catch(e){}return RejectRequest}return result},shouldProcess:function(contentType,contentLocation,requestOrigin,insecNode,mimeType,extra){return Accept},};var components=[MozPolicyComponent];function NSGetModule(compMgr,fileSpec){return XPCOMUtils.generateModule(components)}